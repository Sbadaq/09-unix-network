
# 《UNIX环境高级编程》卷2第4章：管道和FIFO要点总结

## 1. 管道的基本概念

- **管道本质**：管道是最早的Unix IPC形式，提供单向数据流
- **局限性**：
  - 半双工通信（数据只能单向流动）
  - 只能在具有共同祖先的进程间使用（通常由父进程创建管道后fork）
- **创建方式**：`pipe(int fd[2])`函数创建，返回两个文件描述符（fd[0]读端，fd[1]写端）

## 2. 管道的使用模式

- **父子进程通信**：
  1. 父进程创建管道
  2. 父进程fork子进程
  3. 父进程关闭读端，子进程关闭写端（或反之）
  
- **shell管道实现**：`ls | more`等命令就是通过管道实现

- **注意事项**：
  - 读取空管道会阻塞直到有数据写入
  - 写入满管道会阻塞直到有空间
  - 所有写端关闭后，读端read返回0（EOF）
  - 所有读端关闭后，写端写入会产生SIGPIPE信号

## 3. FIFO（命名管道）

- **与匿名管道的区别**：
  - 有名称（在文件系统中可见）
  - 可用于无亲缘关系的进程间通信
  - 通过`mkfifo`函数或`mkfifo`命令创建

- **创建与使用**：
  ```c
  #include <sys/stat.h>
  int mkfifo(const char *path, mode_t mode);
  ```
  
- **打开规则**：
  - 只读打开会阻塞直到有进程为写而打开
  - 只写打开会阻塞直到有进程为读而打开
  - 可以指定O_NONBLOCK标志避免阻塞

## 4. 管道和FIFO的读写特性

- **原子性**：PIPE_BUF大小内的写入是原子的（通常为512字节或更大）
- **阻塞与非阻塞**：
  - 默认是阻塞的
  - 可通过fcntl设置O_NONBLOCK标志变为非阻塞
- **EOF处理**：当所有写端关闭时，读端会读到EOF

## 5. 实际应用考虑

- **双向通信**：需要创建两个管道实现双向通信
- **进程同步**：管道可用于进程同步（如父子进程同步）
- **性能考虑**：管道通常比FIFO更快，但FIFO更灵活

## 6. 相关函数总结

| 函数 | 描述 |
|------|------|
| pipe | 创建匿名管道 |
| mkfifo | 创建命名管道(FIFO) |
| open | 打开FIFO（注意阻塞行为） |
| read/write | 读写管道/FIFO |
| close | 关闭管道/FIFO描述符 |

理解这些概念对于实现Unix/Linux环境下的进程间通信至关重要，是后续学习更复杂IPC机制的基础。